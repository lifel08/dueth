<%= content_for :head do %>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet'/>
<% end %>

<%= content_for :footer_script do %>
  <script type="text/javascript">
      mapboxgl.accessToken = 'pk.eyJ1IjoibGlmZWwwOCIsImEiOiJja252cDQ1Mmkwb3h4Mm9vYWY3Z3YycDdoIn0.3Jn2hjSix6AUKv4zPqAUgw';

      var instruments = <%= j @instruments %>
      console.log(instruments)

      var map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/streets-v11',
          // center: center,
          zoom: 12
      });

      instruments.forEach(function(instrument) {

        map.on('load', function () {
            // create the popup
            var popup = new mapboxgl.Popup({ offset: 45 }).setText(
              instrument.title
            );

            var marker = new mapboxgl.Marker({
                color: "#FFFFFF",
                draggable: true
            }).setLngLat([instrument.latitude, instrument.longitude])
                .setPopup(popup)
                .addTo(map);
        })

      })

      // add markers to map
  </script>
<% end  %>

<section>
  <h1> <%= params[:title] %> rental <%= params[:location] %></h1>
    <div class="content">
      <div class="cards">
        <% @instruments.each do |instrument| %>
          <%= render "./components/instrument_card_big", instrument: instrument %>
        <% end %>
      </div>
      <div id='map' >
      </div>
    </div>
</section>
